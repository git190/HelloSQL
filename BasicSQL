/*
åŸºç¡€è¯­å¥
*/

-- æŸ¥è¯¢æŒ‡å®šå­—æ®µå¹¶è¿”å›
SELECT population,name FROM world
  WHERE name in ('Germany','China');

-- æŸ¥è¯¢æ‰€æœ‰å­—æ®µ
select * from world;

-- æ”¹å
select name å›½å®¶, population äººå£;

-- æŸ¥è¯¢ç»“æœå»é‡
select distinct name from world  
select distinct name population from world  --åä¸¤åˆ—å”¯ä¸€å€¼
select name,round(gdp/population,-3)  -- -3è¡¨ç¤ºå››èˆäº”å…¥åˆ°åƒä½ï¼Œæ¯”å¦‚21254å˜ä¸º21000

-- ğŸ’¦ æŸ¥è¯¢å¸¦å•å¼•å·
SELECT * FROM nobel
 where winner ='EUGENE O''NEILL'  --åå­—å«EUGENE O'NEILLï¼Œå¤šåŠ ä¸€ä¸ªå¼•å·

-- ğŸ’¦order by, æ’åº
-- ç”¨æ³•ï¼šåˆ—åï¼Œåˆ—åï¼Œåˆ—å+ decs æˆ–ascè¡¨ç¤ºé™åºæˆ–å‡åº
SELECT winner,yr,subject FROM nobel
 where winner like 'Sir%' 
 order by yr desc, winner asc  -- å…ˆyearåˆ—é™åºï¼Œå†winenrå‡åº 

-- ğŸ’¦ORDER BY subject in ,è¿”å›å¸ƒå°”å€¼ï¼ˆtrueæˆ–falseï¼‰
  -- ä¸åœ¨åŒ–å­¦å’Œç‰©ç†çš„è¿”å›Falseï¼Œå†æŒ‰ç…§subjecté»˜è®¤å‡åºï¼ŒTrueåœ¨Falseåé¢ï¼Œè‡ªç„¶å°±æ’åœ¨æœ€åº•ä¸‹
  ORDER BY subject in ('chemistry ', 'physics '),subject,winner 

-- åˆ—ç®€å•è®¡ç®—
select name,(gdp/population)
select name,ROUND(population / 1000000.0, 2)  --ä¿ç•™ä¸¤ä½

-- ğŸ’¦ where æŸ¥è¯¢åˆ—çš„æŒ‡å®šèŒƒå›´
-- è¿ç®—ç¬¦ï¼ˆï¼ï¼Œï¼œï¼‰ï¼ŒèŒƒå›´ï¼ˆnot inç­‰ï¼‰ï¼Œé€»è¾‘åˆ¤æ–­ï¼ˆis nullï¼Œä¼˜å…ˆçº§andï¼orï¼‰
select name, populaition form word
  where populaition between 1000 and 2000;

select name,population,area
from world
where (area >= 3000000 or population >= 250000000)
 AND NOT (area >= 3000000 AND population >= 250000000);  -- ä¸èƒ½åŒæ—¶æ»¡è¶³
 

-- ğŸ’¦ like å­—ç¬¦ç­›é€‰
-- %ä»£è¡¨é›¶æˆ–å¤šä¸ªå­—ç¬¦ï¼Œä¸‹åˆ’çº¿_å ä½ç¬¦ä»£è¡¨å•ç‹¬å­—ç¬¦
select name from world
  where name like 'Y%'  -- è¡¨ç¤ºyå¼€å¤´


-- ğŸ’¦ countï¼Œè®¡ç®—æ•°é‡
select count(*)  -- count()æ‹¬å·é‡Œæ²¡æœ‰å­—æ®µï¼Œè®¡ç®—è¡Œæ•°ï¼Œæœ‰ï¼Œè®¡ç®—è¯¥åˆ—å¤šå°‘è¡Œï¼Œå¿½ç•¥nanè¡Œ
from world


--ğŸ’¦ length è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦
SELECT name, capital
  FROM world
 WHERE LENGTH(name) = length(capital)



--ğŸ’¦ limitï¼Œå–æ•°ã€‚ä»…åœ¨MySQLä¸­ä½¿ç”¨ï¼Œå¸è½½
 SELECT name,  capital
FROM world
order by name
limit 3,4  -- ä»ç¬¬3+1è¡Œå¼€å§‹ï¼Œå–4è¡Œï¼Œåˆ°ç¬¬7è¡Œ
limit 3  -- å–å‰ä¸‰è¡Œ



-- ğŸ’¥ğŸ’¥ğŸ’¥æŸ¥è¯¢å’Œæ›¿æ¢
-- æå–nameåç¼€ï¼Œç”Ÿäº§ä¸€åˆ—extension
SELECT name, SUBSTRING(capital, LENGTH(name) + 1) AS extension
FROM world
WHERE capital LIKE CONCAT(name, '%') 
  AND LENGTH(capital) > LENGTH(name);


/*
èšåˆå‡½æ•°
*/

-- åˆ—ç®€å•è®¡ç®—
select name,(gdp/population)
select name,ROUND(population / 1000000.0, 2)  --ä¿ç•™ä¸¤ä½
select avg(gdp) --ç›´æ¥è¿”å›è®¡ç®—ç»“æœ 

-- ğŸ’¦group by, èšåˆ
select continent, count(name)  -- åœ¨groupbyåŸºç¡€ä¸Šï¼Œè®¡ç®—å¤§æ´²å†…å„å›½å®¶æ•°é‡
  from world
  group by continent  -- èšåˆå¤§æ´²å†…çš„å›½å®¶ï¼Œæ”¾åœ¨ä¸€èµ·ï¼Œå»é‡continentå’Œnameé‡å¤å€¼

select yr, subject, count(winner)  	--è®¡ç®—æ¯å¹´å„ç§‘ç›®çš„è·å¥–äººæ•°
  from nobel
  where yr between 2013 and 2015
  group by yr, subject		-- èšåˆå¹´ä»½å’Œç§‘ç›®ï¼Œå¾—åˆ°äºº
  order by yr desc, count(winner) asc		--æ’åº

-- ğŸ’¦ havingï¼Œèšåˆåç­›é€‰
select continent
  from world
  group by continent									--å…ˆgroupby
  having sum(population)>=100000000 	--å†ï¼Œå¤§æ´²æ€»äººå£è¶…è¿‡1äº¿å…ƒ

/*
ä¸€äº›å‡½æ•°
*/

-- ğŸ’¦roundï¼Œ
select name,round(gdp/population,-3)  -- -3è¡¨ç¤ºå››èˆäº”å…¥åˆ°åƒä½ï¼Œæ¯”å¦‚21254å˜ä¸º21000
round(12.456,2)  --ç»“æœä¸º12.47
round(123.4,-2)		--ç»“æœä¸º100


-- ğŸ’¦ concatå­—ç¬¦ä¸²ç»„åˆ
select capital,name 
from world
where capital like CONCAT('%', name, '%');  -- è¡¨ç¤ºnameåœ¨capitalå­—ç¬¦ä¸²ä¸­
  and capital <> name  --  å­—ç¬¦å®Œå…¨ä¸ç›¸åŒ
  
WHERE capital like concat(name,' City')  -- name Cityç»„åˆ


-- ğŸ’¦replace, æ›¿æ¢å‡½æ•°
replace('A',a)  --Aæ›¿æ¢ä¸ºa


--ğŸ’¦left right, æå–ç¬¬å‡ ä¸ªå­—ç¬¦ï¼Œsubstring(string, start_position, length)
SELECT name,  capital
  FROM world
  where LEFT(name,1)= LEFT(capital ,1)  --æå–å·¦æ•°ç¬¬ä¸€ä¸ªå­—ç¬¦
  and name!=capital

substring('najfa', -2, 1) 		--ä»-2ä½å¼€å§‹æå–3ä¸ªå­—ç¬¦ï¼Œå¾—åˆ°f
SUBSTRING('Hello, World!', 8)	--ä»ç¬¬ 8 ä¸ªå­—ç¬¦å¼€å§‹æå–ï¼Œæå–åˆ°å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œå¾—åˆ°worldï¼


-- ğŸ’¦cast(x as type)ï¼Œæ•°æ®ç±»å‹è½¬æ¢å‡½æ•°
-- typeå‚æ•°å¯ä»¥å†™ä¸ºï¼Œchar(n),date,time,datetime,decimaç­‰


-- æ—¶é—´å‡½æ•°
-- ğŸ’¦year(date), month(date), day(date)ï¼Œè·å–å¯¹åº”å¹´ï¼Œæœˆï¼Œæ—¥
-- ğŸ’¦date_addï¼Œå¯¹èµ·å§‹æ—¶é—´è¿›è¡ŒåŠ æ“ä½œï¼Œdate_subï¼Œæ—¶é—´è¿›è¡Œå‡æ“ä½œ
-- ğŸ’¦datediffï¼Œç®—ä¸¤ä¸ªæ—¥æœŸçš„å¤©æ•°å·®
-- ğŸ’¦date_formatï¼Œæ ¼å¼åŒ–


-- æ¡ä»¶åˆ¤æ–­å‡½æ•°
-- ğŸ’¦if(expr,v1,v2)ï¼Œæ¡ä»¶è¿”å›ï¼Œæ»¡è¶³ifè¿”å›v1ï¼Œ
-- ğŸ’¦case whenï¼Œ


/*
ä¸€äº›å‡½æ•°
*/


-- çª—å£å‡½æ•°ğŸ’¦over
-- over([partition by å­—æ®µå] [order by å­—æ®µå asc|desc])
-- æ’åº rank()over() dense_rank()over() row_number()over()
-- å‘ä¸Šåç§» lag(å­—æ®µå,åç§»é‡[,é»˜è®¤å€¼])over() 
-- å‘ä¸‹åç§»ï¼Œlead(å­—æ®µå,åç§»é‡[,é»˜è®¤å€¼])over() 

-- overä¾‹é¢˜
select year, party, votes,  --  --æŸ¥è¯¢s1400å¤§åŒºï¼Œæ¯å¹´ä¸åŒpartyå¾—ç¥¨æ•°votesï¼Œ
  rank()over(partition by year order by votes desc) as posn	--å€™é€‰äººæ ¹æ®votesæ’åº
  from ge
  where district = 's1400'		
  order by party year --æœ€åå›¢ä½“å’Œæ—¶é—´æ’åº

-- åç§»ä¾‹é¢˜
select 
country
,date_format(time,'%Y-%m-%d',) date  --æ ‡å‡†å¹´æœˆæ—¥æ—¶é—´ 
,confirmed æˆªæ­¢å½“å¤©ç´¯è®¡ç¡®è¯Šæ•°
,lag(confirmed,1)over(partition by country order by time) æˆªæ­¢æ˜¨å¤©ç´¯è®¡ç¡®è¯Šæ•°
,(confirmed-lag(confirmed,1)over(partition by country order by time)) æ¯å¤©æ–°å¢
  from covid
  where country in ('Frence', 'Germany') and month(time)=1
  order by time



